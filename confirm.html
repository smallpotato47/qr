<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>安心出行</title>

<head>
<link rel="icon" href="image/favicon.ico" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#12B188" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="image/icon-192x192.png" />
<link rel="manifest" href="manifest.json" />
<style>
		@font-face {
			font-family: myFirstFont;
			src: url(font/Rubik-VariableFont_wght.ttf);
		}	

		html, body {
			margin: 0; 
			height: 100%; 
			overflow: hidden;
			position: fixed;
			font-family: myFirstFont, "Microsoft JhengHei" ;
		}
		* {
			margin: 0;
			padding: 0;
			background-color: #12B188;
		}
		
		body {
			margin: 0px;			
			-webkit-font-smoothing: antialiased;
			width: 100%;
			height: 100%;
			text-shadow: rgb(0 0 0 / 70%) 0px 1px 2px;
		}
		
		.content {
			width: 100%;
			height: 100%;
			display: flex;
			-webkit-box-pack: center;
			justify-content: center;
			flex-direction: column;
		}
		
		.youHvEnter {
			color: rgb(255, 255, 255);
			text-align: center;
			font-size: 17px;
			margin-top: 25%;
			margin-bottom:1%;
			}
	
		.cookiePlace {
			font-family: myFirstFont, "Microsoft JhengHei" ;
			text-align: center;
			font-size: 31px;
			background-color: transparent;
			border: 0px;
			outline: none;
			margin: 0 auto;
			color: rgb(254, 212, 38);
			line-height: 36px;
			font-weight:600;
			width:80%;
			letter-spacing: -1px;
			text-shadow: rgb(0 0 0 / 70%) 0px 1px 2px;
			margin-bottom:1%;
		}
		.cookieDate {
			color: rgb(255, 255, 255);
			font-size: 18px;
			text-align: center;
		}

		.ticktick {
			margin: 20% auto auto;
			width: 32%;
			max-height: 110px;
		}
		.changeTick {
			width: 10%;
			text-align: left;
			padding-left: 24px;
			line-height: 32px;
		}
		#hourNumber {
			width: 80%;
			text-align: left;
			line-height: 32px;
		}
		.textdis {
			height: 32px;
			display: inline-block;
			vertical-align: top;
			margin-right: 8px;
		}
		.changestatus {
			flex-shrink: 0;
			padding-right: 24px;
			line-height: 32px;
			width:10%;
		}
		.subfooter {
			margin-bottom: 16px;
			width: 100%;
			display: flex;
			max-width: 380px;
			margin: 16px auto;
		}
		.footerDiv {
			width: 100%;
			position: absolute;
			bottom: 0px;
			text-align: center;
			color: rgb(255, 255, 255);
			padding-bottom: 40px;
		}

		.exitclass {
			display: block;
			margin: auto auto 16px;
			font-size: 24px;
			padding: 10px 0px;
			width: 80%;
			border-radius: 48px;
			background-color: rgb(254, 212, 38);
			box-shadow: rgb(0 0 0 / 50%) 0px 2px 4px 0px;
			border: 0px;
			outline: none;
			font-family: Microsoft JhengHei;
			font-weight:bold;
			max-width: 300px;
		}
		.crossImg {
			height: 20px;
			float: right;
			position: absolute;
			top: 24px;
			right: 24px;
		}
		
		input[type="number"]{
			text-align:center;
			width: 100%;
			padding: 12px 20px;
			margin: 0 auto;
			box-sizing: border-box;
			border: none;
			background-color: #3CBC8D;
			color: rgb(254, 212, 38);
			font-size:30px;
			font-family: myFirstFont;
			font-weight:600;
		}
		button{
			display: block;
			margin: auto;
			margin-bottom: 16px;
			margin-top: 10%;
			font-size: 24px;
			padding: 10px 100px;
			border-radius: 48px;
			background-color: #fed426;
			box-shadow: 0px 2px 5px 0px rgb(0 0 0 / 50%);
			border: 0;
			outline: none;
			font-family: myFirstFont;
			font-weight:600;		
		}
		::placeholder {
			color: #cccccc;
			opacity: 0.7; /* Firefox */
			font-weight:400;
		}
		
		#menuInput {
			display: none;
			z-index: 2100;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 80vw;
			background-color: rgb(0,0,0,0.8);
			padding: 100vh;
		}
		
		#menuInput span {
			position: absolute;
			left: 50%;
			transform: translate(-50%, 0px);
			background-color: transparent;
			font-weight: 600;
		}
		
		
	</style>
</head>
<script type="text/javascript" src="base64.js"></script>

<script>
function checkCookie(){
	var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));
	var oldTime = new Date(parseInt(myDisplay.unixTime));
	if(localStorage.hasOwnProperty('myDisplay')){
		if(new Date().getTime() - myDisplay.unixTime <=  myDisplay.expires && myDisplay.display){
			document.getElementById("myPlace").innerHTML = myDisplay.place;
			document.getElementById("cookieDate").innerHTML = myDisplay.checkInTime;
			document.getElementById("hourNumber").innerHTML = myDisplay.expires / 3600000 +"小時後自動離開" ;				
		}else{
			var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));	
			myDisplay.display = false;	
			oldTime.setMinutes(oldTime.getMinutes() + (myDisplay.expires / 60000));
			var timeRecordOut = oldTime.getFullYear() + "-" + (oldTime.getMonth()<10?'0':'') + (oldTime.getMonth() +1 )+"-"+ (oldTime.getDate()<10?'0':'') + oldTime.getDate() + " " +(oldTime.getHours()<10?'0':'') + oldTime.getHours() +":"+ (oldTime.getMinutes()<10?'0':'') + oldTime.getMinutes();
			
			var myObj = JSON.parse(localStorage.getItem("myHistory"));
			myObj.record[myObj.record.length-1].checkOutTime = timeRecordOut;
			localStorage.setItem("myHistory", JSON.stringify(myObj));			
			localStorage.setItem("myDisplay", JSON.stringify(myDisplay));
			window.location.href = "index.html";	
		}
	}else{
		window.location.href = "index.html";
	}
}

function delCookie(){
	if(confirm("Do you want to leave now?")){		
		var myNewTime = JSON.parse(localStorage.getItem("myHistory"));
		var timeNow = new Date();	
		var timeRecordOut = timeNow.getFullYear() + "-" + (timeNow.getMonth()<10?'0':'') + (timeNow.getMonth() +1 )+"-"+ (timeNow.getDate()<10?'0':'') + timeNow.getDate() + " " +(timeNow.getHours()<10?'0':'') + timeNow.getHours() +":"+ (timeNow.getMinutes()<10?'0':'') + timeNow.getMinutes();
		myNewTime.record[myNewTime.record.length-1].checkOutTime = timeRecordOut;	
		localStorage.setItem("myHistory", JSON.stringify(myNewTime));
		console.log(timeRecordOut);
		var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));	
		myDisplay.display = false;
		localStorage.setItem("myDisplay", JSON.stringify(myDisplay));
		window.location.href = "index.html";
	  } else {
		return '';
	  }
}

function changeTime(time){
	if (time != "" || time != NULL){
		if (time > 0 && time <= 24){
			var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));
			myDisplay.expires = time * 3600000 //1 hour's ms
			localStorage.setItem("myDisplay", JSON.stringify(myDisplay));
			var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));
			
			var oldTime = new Date(parseInt(myDisplay.unixTime));
			
			oldTime.setMinutes(oldTime.getMinutes() + (myDisplay.expires / 60000));
			var timeRecordOut = oldTime.getFullYear() + "-" + (oldTime.getMonth()<10?'0':'') + (oldTime.getMonth() +1 )+"-"+ (oldTime.getDate()<10?'0':'') + oldTime.getDate() + " " +(oldTime.getHours()<10?'0':'') + oldTime.getHours() +":"+ (oldTime.getMinutes()<10?'0':'') + oldTime.getMinutes();
			
			var myObj = JSON.parse(localStorage.getItem("myHistory"));
			myObj.record[myObj.record.length-1].checkOutTime = timeRecordOut;
			localStorage.setItem("myHistory", JSON.stringify(myObj));			
			localStorage.setItem("myDisplay", JSON.stringify(myDisplay));
			
			
			document.getElementById("hourNumber").innerHTML = time +"小時後自動離開" ;	
			document.getElementById('menuInput').style.display = 'none'
			
			location.reload();
		}else{
			alert("Range: 1 - 24");
		}	
	}
}
</script>
</head>
	
<body onload="checkCookie()">
<div class="content">
<img src="image/cross.d2bbc7f7.svg" class="crossImg" onclick="delCookie()">
<div class="youHvEnter">你已進入場所</div>
<p class="cookiePlace" id="myPlace"></p>
<div id="cookieDate" class="cookieDate"></div>
<img src="image/tick.6d45b966.svg" class="ticktick">



<div class="footerDiv">
	<div class="subfooter">
		<div class="changeTick"><img src="image/checkbox.7f6c2da0.svg" class="textdis"></div><div id="hourNumber">4小時後自動離開</div><div class="changestatus" onclick="document.getElementById('menuInput').style.display = 'block';">變更</div>
	</div>
	<button class="exitclass" onclick="delCookie()">離開</button>
	<div>當你離開時請緊記按"離開"</div>	
</div>

<div id="menuInput" >
	<input type="number" id="enterTime" placeholder="自動離開時間(小時)"> <br>
	<button onclick="changeTime(document.getElementById('enterTime').value); ">確認更改</button>
	<span onclick="document.getElementById('menuInput').style.display = 'none';" style="color:white;">取消</span>
</div>
</div>
</body>
	
</html>