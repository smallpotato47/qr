<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>安心出行</title>
<head>
	<link rel="icon" href="./image/favicon.ico" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="theme-color" content="#50ae8a" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="apple-touch-icon" href="image/icon-192x192.png" />
	<link rel="manifest" href="manifest.json" />
	
	<style>
		@font-face {
			font-family: myFirstFont;
			src: url(font/Rubik-VariableFont_wght.ttf);
		}	
		html, body {
			margin: 0; 
			height: 100%; 
			overflow: hidden;
			position: fixed;			
		}
		* {
			margin: 0;
			padding: 0;
			background-color: #50ae8a;
		}
		#blcokMe{
			display:none;
			z-index:777;
		}
		.imgbox {
			z-index:1;
			height: 100%;
		}
		.center-fit {
			width: 100%;
			max-height: 100vh;
			margin: auto;
		}
		.text-z-index{
			z-index:999;				
		}		
		#todayDay{
			font-size:18px;	
			color:white;
			position: absolute;
			top:12%;
			left:8.5%;			
			-webkit-font-smoothing: antialiased;
			text-shadow: rgb(0 0 0 / 80%) 0px 1px 2px;
			font-family: myFirstFont;			
		}
		#yesterdayDay{
			font-size:15px;	
			color:#000404;
			position: absolute;
			top:76.3%;
			left:13%;
			background-color:#bde1d7;
			font-family: myFirstFont;
			font-weight: 600;
		}
		#noHK{
			display:none;
			z-index:1;
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			color: red;
			font-weight: bold;
			font-family: myFirstFont;
			-webkit-animation:linear infinite alternate;
			-webkit-animation-name: run;
			-webkit-animation-duration: 2s;
		}
		h3{
			text-align:center;
			width:100%;
			
		}
		@-webkit-keyframes run {
			0% { left: 30%;}
			50%{ left : 70%;}
			100%{ left: 30%;}
		}
	::placeholder {
		color: #cccccc;
		opacity: 0.7; /* Firefox */
		font-weight:400;
	}
	#menuInput {
		position:relative;
		z-index:2100;
		top: 78vh;*/
		display: none;
		z-index: 2100;
		position: fixed;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		width: 100%;
		padding: 100vh;
	}
	input[type="password"]{
		text-align:center;
		width: 100%;
		padding: 12px 20px;
		margin: 0 auto;
		box-sizing: border-box;
		border: none;
		background-color: #3CBC8D;
		color: rgb(254, 212, 38);
		font-size:30px;
		font-family: myFirstFont;
		font-weight:600;
	}
	button{
		display: block;
		margin: auto;
		margin-bottom: 16px;
		margin-top: 10%;
		font-size: 24px;
		padding: 10px 100px;
		border-radius: 48px;
		background-color: #fed426;
		box-shadow: 0px 2px 5px 0px rgb(0 0 0 / 50%);
		border: 0;
		outline: none;
		font-family: myFirstFont;
		font-weight:600;		
	}
	#getpw{
		display:none;
	}
		
	</style>
</head>
<script>
function setLocalStorage(pw){
	var pw = document.getElementById("enterPassword").value;
	if(pw != ""){		
		var checkSt = [pw,true,new Date().getTime()];
		localStorage.setItem("checkSt", JSON.stringify(checkSt));
		document.getElementById("blcokMe").style.display = "block";	
		document.getElementById("menuInput").style.display = "none";
		preload();
	}
}

function checkLocalStorage(){
	var pw = document.getElementById("enterPassword").value;		
	if (pw == (JSON.parse(localStorage.getItem("checkSt"))[0])) {
		document.getElementById("blcokMe").style.display = "block";	
		document.getElementById("menuInput").style.display = "none";
		var obj = JSON.parse(localStorage.getItem("checkSt"));
		obj[2] = new Date().getTime();
		localStorage.setItem("checkSt", JSON.stringify(obj));
		preload();
		
	}else{
		document.getElementById("noHK").style.display = "block";
		document.getElementById("menuInput").style.display = "none";
		document.getElementById("noHK").innerHTML = "我愛習大大";
	}	
}

function preload(){	
	if (localStorage.hasOwnProperty('checkSt')){
	console.log((new Date().getTime()) - (JSON.parse(localStorage.getItem("checkSt"))[2]));
		if((new Date().getTime()) - (JSON.parse(localStorage.getItem("checkSt"))[2]) > 31536000000){ //31536000000			
			if(confirm("Delete All?")){							
				localStorage.clear();
				location.reload();
			} else {
				return '';
			}			
		}else{
			if((new Date().getTime()) - (JSON.parse(localStorage.getItem("checkSt"))[2]) < 86400000){ //86400000, 2678400000
				document.getElementById("blcokMe").style.display = "block";	
				document.getElementById("menuInput").style.display = "none";
				var obj = JSON.parse(localStorage.getItem("checkSt"));
				obj[2] = new Date().getTime();
				localStorage.setItem("checkSt", JSON.stringify(obj));
			}else{
				document.getElementById("setpw").style.display = "none";
				document.getElementById("getpw").style.display = "block";
			}
		}
	}else{
		return "";	
	}


	var d = new Date();		
	var dyesterday = new Date();
	dyesterday.setDate(dyesterday.getDate() -1 );
	var weekday = new Array(7);
	  weekday[0] = "星期日";
	  weekday[1] = "星期一";
	  weekday[2] = "星期二";
	  weekday[3] = "星期三";
	  weekday[4] = "星期四";
	  weekday[5] = "星期五";
	  weekday[6] = "星期六";
	  var n = weekday[d.getDay()];
	  
	  var timeRecord = d.getFullYear() + "-" + ((d.getMonth() +1 )<10?'0':'') + (d.getMonth() +1 )+"-"+ (d.getDate()<10?'0':'') + d.getDate() + ", " + n;
	  var yesterdayRecord = dyesterday.getFullYear() + "-" + ((dyesterday.getMonth() +1 )<10?'0':'') + (dyesterday.getMonth() +1 )+"-"+ (dyesterday.getDate()<10?'0':'') + dyesterday.getDate();
	  
	  //var yesterday = oldDay.getFullYear() + "-" + (oldDay.getMonth() +1 )+"-"+ oldDay.getDate();
	document.getElementById("todayDay").innerHTML = timeRecord;
	document.getElementById("yesterdayDay").innerHTML = "最後更新 "+ yesterdayRecord;
	
	var x = screen.width;
	var y = screen.height;
	var ratio = y/x;
	console.log(ratio);
	if (ratio < 2){
		document.getElementById("myImg").src = "image/welcome33.jpg";
		
		document.getElementById("todayDay").style.backgroundColor = "#12b188";
		document.getElementById("todayDay").style.top = "10%";
		document.getElementById("todayDay").style.left = "7%";
		
		document.getElementById("yesterdayDay").style.top = "76.2%";
		document.getElementById("yesterdayDay").style.left = "11%";		
	}
}
</script>

<body onload="preload();">
<div id="country"></div>
<div id="details"></div>
<h3 id="noHK"></h3>
<div id="blcokMe">
	<a href="scan.html">
	<div class="imgbox">
		<img id = "myImg" src="image/welcome2.jpg" alt="welcome" class="center-fit">
	</div>
	</a>
	<div class="text-z-index">
		<p id="todayDay"></p>
		<p onclick='window.location.href = "history.html";' id="yesterdayDay"></p>
	</div>	
	<script>
		if ('serviceWorker' in navigator) {
			navigator.serviceWorker.register('./sw.js')
			.then(reg => console.log('SW registered!', reg))
			.catch(err => console.log('Error!', err));
		}
	</script>
</div>
<div id="menuInput">
	<input type="password" id="enterPassword" placeholder="請輸入自訂密碼"> <br>
	<button id="setpw" onclick="setLocalStorage(document.getElementById('enterPassword').value)">進入</button>
	<button id="getpw"onclick="checkLocalStorage(document.getElementById('enterPassword').value)">進入</button>
	<span onclick="localStorage.removeItem('checkSt');location.reload();" style="color:#50ae8a;  font-size:100px; position:absolute; top: 65%;">取消</span>
</div>
</body>
	
</html>
