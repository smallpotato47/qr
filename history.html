<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>安心出行</title>
<head>
<link rel="icon" href="image/favicon.ico" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="theme-color" content="#12B188" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="apple-touch-icon" href="image/icon-192x192.png" />
<link rel="manifest" href="manifest.json" />
	
<style>
	@font-face {
		font-family: myFirstFont;
		src: url(font/Rubik-VariableFont_wght.ttf);
	}	

	body {
		margin: 0;
		padding:0;
		-webkit-font-smoothing: antialiased;
		-moz-osx-font-smoothing: grayscale;
		background-color: #12B188;
		width: 100%;
		height: 100%;
		overflow: hidden;
		position: fixed;
		font-family: myFirstFont, "Microsoft JhengHei" ;
		//text-shadow: rgb(0 0 0 / 80%) 0px 1px 2px;
		
	}
	.pageHeader{	
		width: 100%;
		position: absolute;
		z-index: 100000;
		color: rgb(255, 255, 255);
		background-color: rgb(18, 177, 136);
		text-align: center;
		line-height: 48px;
		font-size:18px;
		font-weight: 600;
		text-shadow: rgb(0 0 0 / 80%) 0px 1px 2px;
	}
	.pageLabel {
		height: 20px;
		top: 14px;
		left: 16px;
		position: absolute;
	}
	.content{
		text-align:center;
		width:100%;
		margin: 0% auto;
	}

	#myRecord{
		background-color: white;
		position:absolute;
		padding:13% 5% 0% 5%;
		font-size:18px;
		text-align:left;
		color:#6c6c6c;
		width:100%;
		height:calc(100% - var(--footer-height));
		overflow-y:scroll;
	}
	.historyLine{
		padding-top:5%;
		padding-bottom:5%; 
		border-bottom: 1px solid #f0f0f0;
		width:90%;
	}
	.historyPlace{
		color: #292c34;
		font-size: 15px;
		padding-bottom: 1%;
		font-weight:bold;
	}
	.historyTime{
		font-size: 13px;
		color:#888888;
	}

	.footerMessage{
		position: fixed;
		bottom: 0px;
		height: var(--footer-height);
		//line-height: calc(var(--footer-height) - 50px);
		background-color: #F0F0F0;
		color:#282B34;
		width: 100%;
		text-align: center;
		font-family: myFirstFont, "Microsoft JhengHei" ;
		font-size:14px;
		font-weight:bold;
	}
	.lockerContainer{
		width:100%;
	}
	.mylocker{
		width:4%;
		position:relative;
		margin:0;		
	}
	.container{
		width:100%;
		position:absolute;
		top:50%;
		left:50%;
		transform:translate(-50%,-85%);
	}
	
	:root {
	  --footer-height: 12%;
	}
	
	#norecord{
		color:#282B34;
		text-align:center;
		width:100%;
		position:absolute;
		top:50%;
		left:50%;
		transform:translate(-50%,-100%);
		z-index:1;
		font-family: myFirstFont, "Microsoft JhengHei" ;
		font-weight:bold;
	}
	
</style>	

</head>
<script>
function preload(){	
	var myObj = JSON.parse(localStorage.getItem("myHistory"));
	var historyTxt = "";
	var timeNow = new Date();
	
	if(localStorage.hasOwnProperty('myHistory')){
	var myObj = JSON.parse(localStorage.getItem("myHistory"));
		for (var i = myObj.record.length - 1 ; i >= 0 ; i--){
			if(new Date().getTime() - myObj.record[i].unixTime > 2678400000){ //2678400000 = 31 days
				myObj.record.splice(0,1);
			}
		}
		localStorage.setItem("myHistory", JSON.stringify(myObj));
		myObj = JSON.parse(localStorage.getItem("myHistory"));
	}

	if(!localStorage.hasOwnProperty('myHistory') || myObj.record[0] == null){
		historyTxt = "沒有記錄";
		document.getElementById("norecord").innerHTML = historyTxt;
	}else{		
		for (var i = myObj.record.length - 1 ; i >= 0 ; i--){
			if(i == 0){
				historyTxt += "<div class='historyPlace' style='padding-top:15px;'>" + myObj.record[i].place + "</div><div class='historyTime' style='padding-bottom: calc(var(--footer-height) + 8%) ;'>" + myObj.record[i].checkInTime + " " + myObj.record[i].checkOutTime + "</div>" ;
			}else{
				historyTxt += "<div class='historyLine'><div class='historyPlace'>" + myObj.record[i].place + "</div><div class='historyTime'>" + myObj.record[i].checkInTime + " " + myObj.record[i].checkOutTime + "</div></div>" ;
			}
		}
		document.getElementById("myRecord").innerHTML = historyTxt;	
	}	
}

function delStorage() {
  if(confirm("Do you want to delete all record?")){
  	localStorage.removeItem("myHistory");
	var noRecord = "沒有記錄";
	var myDisplay = JSON.parse(localStorage.getItem("myDisplay"));	
	myDisplay.display = false;
	localStorage.setItem("myDisplay", JSON.stringify(myDisplay));
	document.getElementById("norecord").innerHTML = noRecord;
	document.getElementById("myRecord").innerHTML = "";
  } else {
    return '';
  }
}
</script>
</head>
	
<body onload="preload();">
<div class="content">
	<div class="pageHeader">
		<a href="welcome.html">
			<img src="image/back.7bf7a56f.svg" class="pageLabel">
		</a>
		出行記錄
	</div>
	<div id = "norecord"></div>
	<div id = "myRecord"></div>
</div>
<div class="footerMessage">
	<div class="container">
		<div class="lockerContainer">
			<img src="image/lock.svg" class="mylocker">
		</div>
			<span>存放應用程式內的出行記錄在31天後會自動刪除<span onclick="delStorage()" >。</span></span>
	</div>
</div>
</body>
</html>
